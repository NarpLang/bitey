
if [[ "$1" == "remove" ]]; then
    if [[ -f "$BITEY/lock" ]]; then
        echo "ðŸ”’ Bitey is locked. Run 'sudo bitey unlock' to remove the lock."
        exit 1
    fi
    sudo bitey lock
    shift 1  # Remove "remove" argument

    for SOFTWARE_NAME in "$@"; do
        INSTALL_PATH="$BITEY/software/$SOFTWARE_NAME"

        if [[ ! -d "$INSTALL_PATH" ]]; then
            echo "âŒ Bitzy thinks $SOFTWARE_NAME is not installed."
            continue
        fi

        cd "$INSTALL_PATH" || continue

        if [[ -f project/remove.sh ]]; then
            echo "ðŸ”§ Bitzy is running remove script for $SOFTWARE_NAME..."
            sudo bash "project/remove.sh"
        else
            echo "âš ï¸ Bitzy didn't find a remove script, continuing with raw removal."
        fi

        echo "ðŸ—‘ï¸ Bitzy is removing $SOFTWARE_NAME..."
        sudo rm -rf "$INSTALL_PATH"

        # Clean bitey_paths and biteyrc
        sudo sed -i "\|$INSTALL_PATH\$|d" "$BITEY/project/bitey_paths"
        sudo sed -i "\|$INSTALL_PATH/bin\$|d" "$BITEY/project/biteyrc"

        echo "âœ… Bitzy removed $SOFTWARE_NAME."
        cd - > /dev/null
    done

    sudo bitey unlock
    exit 0
fi

if [[ "$1" == "update" ]]; then
    if [[ -f "$BITEY/lock" ]]; then
        echo "ðŸ”’ Bitey is locked. Run 'sudo bitey unlock' to remove the lock."
        exit 1
    fi
    sudo bitey lock
    mapfile -t BITEYRC < $BITEY/project/biteyrc
    mapfile -t BITEY_PATHS < $BITEY/project/bitey_paths
    for path in "${BITEY_PATHS[@]}"; do
        if [ -d "$path" ]; then
            cd "$path" || continue
            
            echo "ðŸ”„ Bitzy is updating path $path..."
            sudo git reset --hard HEAD
            sudo git pull
            sudo chmod +x bin/*
            if [[ -f project/update.sh ]]; then
                echo "ðŸ”§ Bitzy is running update script..."
                sudo bash "project/update.sh"
            fi
            cd - > /dev/null || exit 0
        fi
    done
    printf "%s\n" "${BITEY_PATHS[@]}" | sudo tee "$BITEY/project/bitey_paths" > /dev/null
    printf "%s\n" "${BITEYRC[@]}" | sudo tee "$BITEY/project/biteyrc" > /dev/null
    sudo bitey unlock
    exit 0
fi
